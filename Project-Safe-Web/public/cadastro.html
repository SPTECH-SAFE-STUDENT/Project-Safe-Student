<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style-copy.css" />
  <script src="./js/sessao.js"></script>
  <link rel="shortcut icon" href="imgfavicon.png">
  <title>Cadastro</title>
</head>

<body>
  <section class="telaCadastro"
    style="display: flex; flex-direction: row; height: 100vh; align-items: center; justify-content: center; gap: 18rem">
    
    <div class="cadastre" id="p1">
      <div class="voltar">
        <a href="./index.html"> < </a>
      </div>
      <div class="formcadastre">
        <form>
          <h1>CADASTRE-SE</h1>

          <h3>Insira Seus Dados Nos Campos Abaixo</h3>

          <p>Nome Completo</p>
          <input id="nome_ipt" type="text" /><br>
          <span id="erro_nome"></span>

          <p>E-mail</p>
          <input id="email_ipt" type="text" /><br>
          <span id="erro_email"></span>

          <p>CRMC</p>
          <input id="crmc_ipt" type="text" /><br>
          <span id="erro_crmc"></span><br>


          <button type="button" onclick="proximaAba(1)">Avançar</button>
          <p style="width:83%; font-size: large; text-align: center; flex-direction: column; display: flex;">Já possui
            cadastro?<a href="./login.html" style="color: #FFB800; text-decoration: underline 1.4px;">Entrar</a></p>

        </form>
      </div>
    </div>


    <div class="cadastre" id="p2" style="display: none;">
      <div class="formcadastre">
        <form>
          <h1>CADASTRE-SE</h1>

          <h3>Insira Seus Dados Nos Campos Abaixo</h3>

          <p>CNPJ</p>
          <input id="cnpj_ipt" type="text"><br>
          <span id="erro_cnpj"></span>

          <p>Senha</p>
          <input id="senha_ipt" type="password"><br>
          <span id="erro_senha"></span>

          <p>Confirmar senha</p>
          <input id="confirmacao_senha_input" type="password"><br>
          <span id="erro_conf_senha"></span>

          <button type="button" onclick="proximaAba(2)">Cadastrar</button>
          <p style="width:84%; font-size: large; text-align: center; flex-direction: column; display: flex;">Já possui
            cadastro?<a href="./login.html" style="color: #FFB800; text-decoration: underline 1.4px;">Entrar</a></p>

          <div id="div_aguardar" class="loading-div">
            <img src="./assets/aguarde-pink.gif" id="loading-gif" />
          </div>
        </form>
      </div>
    </div>

    <div class="cadastro_IMG">
      <img src="./img/cadastro.png" alt="Logo do nosso site">
    </div>
  </section>
</body>

</html>

<script>
// JUNTAR COM A VERIFICAçAO DO AQUATECH PARA CAMPOS NULOS PARA VERIFICAR A SENHA*****
//   let quantidadeCadastros = 0

//   function MensagemFor() {

//     let cpf = cpf_ipt.value
//     let senha = senha_ipt.value
//     let email = email_ipt.value
//     let validador = false
//     let arrobaEmail = email.indexOf('@')
//     let pontoEmail = email.indexOf('.')

//     for (let contadorSenha = 0; contadorSenha <= 9; contadorSenha++) {
//       if (senha.indexOf(contadorSenha) >= 0) { validador = true }
//     }
//     if (arrobaEmail == -1) {
//       alert("O e-mail deve conter um @")
//     } else if (pontoEmail == -1) {
//       alert("O e-mail deve conter um ponto")
//     } else if (cpf.length != 11 && cpf.length != 14) {
//       alert("O campo cpf deve ser preenchido com 11 ou 14 caracteres")
//     } else if (senha.length < 8) {
//       alert("A senha deve ter no mínimo 8 caracteres ")
//     } else if (validador == false) {
//       alert("A senha deve conter números ")
//     } else { 
//       quantidadeCadastros++

//       for (let contador = 0; contador <= quantidadeCadastros; contador++) {
//         div_mensagemFor.style.display = "block";
//         div_mensagemFor.innerHTML = (`Parabéns! Você é nosso usuário N° ${contador} cadastrado, aguarde um momento que você será redirecionado para pagina de Login...`)
//       }
//       setTimeout(function(){
//         window.location.href = "./login.html"
//       },6600);  
//     }
// }

function cadastro() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_ipt.value;
    var crmcVar = crmc_ipt.value
    var cnpjVar = cnpj_ipt.value
    var emailVar = email_ipt.value
    var senhaVar = senha_ipt.value
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
    // var crmcVar = crmc_ipt.value
    // var empresaVar = listaEmpresas.value;
    //verica se a campos nulos 
    if (
      nomeVar == "" ||
      crmcVar == "" ||
      cnpjVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == "" 
    ) {
      // cardErro.style.display = "block";
      
        alert("Mensagem de erro para todos os campos em branco");

      // finalizarAguardar();
      return false;
    } else {
      alert("teste else verificação dos campos nulos ou validos")
      // setInterval(sumirMensagem, 5000);
    }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        crmcServer: crmcVar,
        cnpjServer: cnpjVar,
        emailServer: emailVar,
        senhaServer: senhaVar
        // empresaServer: empresaVar
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          // cardErro.style.display = "block";

          alert(
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...");

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          // finalizarAguardar();
        } else {
          // throw 
          alert("Houve um erro ao tentar realizar o cadastro!");
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });

    return false;
  }
  
</script>