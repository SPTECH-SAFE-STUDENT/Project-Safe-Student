<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/dashboard.css">
    <title>Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <!-- <script src="http://www.chartjs.org/samples/latest/utils.js"></script> -->
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            width: 150;
            height: 100;
        }

        .div-graficos {
            width: 150px;
            height: 80px;
        }
    </style>
</head>

<body onload="dashboardEscolhida()">
    <div class="content">
        <div class="menuLateral">
            <img src="./img/logo_SS.png">
            <div>
                <h1>Bem vindo<br>de volta!</h1>
            </div>
            <div id="opcoes_menu" class="opcao">
                <ul>
                    <li><a onclick="telaDash()" id="OpcDashboard">Dashboard</a></li>
                    <li><a onclick="telaHistorico()" id="OpcHistorico">Histórico</a></li>
                </ul>
            </div>
        </div>

        <!-- <div id="veiculos" class="SelectDiv">
            <div class="selecoes">
                <h1> SELECIONE UM VEÍCULO </h1>
                <input type="text" id="textInput" placeholder="Digite uma placa">
                <select id="select_placa">
                    <option value="#">Selecione uma placa</option>
                    <option value="placaUM">FCB1B34</option>
                    <option value="placaDOIS">HPG7G77</option>
                </select><br>
                <button onclick="dashboardEscolhida()">Começar Viagem</button>
                <div id="div_erro" class="mensagemErro">
                    <span id="span_mensagem_erro">
                    </span>
                </div>
            </div>
        </div> -->

        <!-- DASHBOARD DA PLACA UM -->
        <div id="dashFCB1B34" class="visao_dash">
            <div class="kpis">
                <div id="div1">
                    <p>Bancos Ocupados</p>
                    <span>12</span>
                </div>
                <div id="div2">
                    <p>Temperatura Mínima do dia</p>
                    <span>18°C</span>
                </div>
                <div id="div3">
                    <p>Temperatura Máxima do dia</p>
                    <span>30°C</span>
                </div>
                <div id="div4">
                    <button id="botaoFinalizar" onclick="voltar()">Finalizar <br> sistema</button>
                </div>
            </div>

            <div class="graficos">

                <div class="canvas">
                    <div class="container-chave">
                        <h2>Bancos Ocupados</h2>
                        <div class="graficos-alinhamento" id="graficos_bancos">
                            <!-- <section class="grafico_chave">
                                <canvas id="chaveUM"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave2UM"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave3UM"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave4UM"></canvas>
                            </section> -->

                        </div>
                    </div>
                    <div class="container-temp">
                        <h2>Temperatura</h2>
                        <section>
                            <canvas id="lm35TemperaturaUM"></canvas>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD PLACA DOIS -->
        <!-- <div id="dashHPG7G77" class="visao_dash" style="display: none;">
            <div class="kpis">
                <div id="1">
                    <p>Temperatura Mínima do dia</p>
                    <span>18°C</span>
                </div>
                <div id="3">
                    <p>Temperatura máxima do dia </p>
                    <span>27.5°C</span>
                </div>
                <div id="2">
                    <p>Temperatura Média da semana</p>
                    <span>25°C</span>
                </div>
                <div id="4">
                    <p>Bancos Ocupados</p><br>
                    <span>14</span>
                </div>
            </div> -->

        <!-- <div class="graficos">

                <div class="canvas">
                    <div class="container-chave">
                        <h2>Bancos</h2>
                        <div class="graficos-alinhamento">
                            <section class="grafico_chave">
                                <canvas id="chaveDOIS"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave2DOIS"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave3DOIS"></canvas>
                            </section>
                            <section class="grafico_chave">
                                <canvas id="chave4DOIS"></canvas>
                            </section>

                        </div>
                    </div>
                    <div class="container-temp">
                        <h2>Temperatura</h2>
                        <section>
                            <canvas id="lm35TemperaturaDOIS"></canvas>
                        </section>
                    </div>
                </div>
            </div> -->
    </div>
    </div>
</body>

</html>

<script>

    function telaDash(){
        let cargo = sessionStorage.CARGO_USUARIO
        if(cargo == 'suporte' || cargo == 'dono'){
            window.location = "./dash.html"
        }else{
            window.location = "./dashboard.html"
        }
    }
   

    function voltar() {
        sessionStorage.clear()
        window.location = './index.html'
    }
    /* SELEÇÃO DE DASHBOARD */
    // function telaVeiculo() {
    //     opcoes_menu.style = 'display: none'
    //     dashFCB1B34.style = 'display: none'
    //     dashHPG7G77.style = 'display: none'
    //     veiculos.style = 'display: block'
    // }

    function buscarTemperatura() {

        const idVan = sessionStorage.PLACA_VAN;

        if (!idVan) {
            console.error('Van do usuário não está definida');
            return;
        }

        fetch(`/dashboard/buscarTemperatura/${idVan}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            }
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    return resposta.json();
                } else {
                    throw new Error("Houve um erro ao tentar trazer o resultado");
                }
            })
            .then(function (data) {
                if (data.length === 0) {
                    console.warn("Nenhum resultado encontrado");
                    return;
                }

                atualizarGrafico(data);
            })
            .catch(function (erro) {
                console.error(`#ERRO: ${erro}`);
            });
    }


    function atualizarGrafico(dadosTemp) {
        const ctx = document.getElementById('lm35Temperatura').getContext('2d');

        if (graficoTemperatura) {
            graficoTemperatura.destroy();
        }

        // Extrai as quantidades do objeto de resultados
        let sensores = dados.map(item => item.lt);

        graficoTemperatura = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Sensor 1', 'Sensor 2'],
                datasets: [{
                    label: 'Temperatura',
                    data: sensores,
                    borderColor: 'transparent',
                    backgroundColor: '#1B1A1A',
                }]
            },
            options: {
                animation: false,
                scales: {
                    x: {
                        display: false,
                        beginAtZero: true,
                    },
                    y: {
                        display: false,
                        beginAtZero: true,
                    }
                },
                animation: {
                    duration: 0
                },
            }
        });
    }

    buscarTemperatura()
    setInterval(buscarTemperatura, 5000)


    function dashboardEscolhida() {
        // let placa = select_placa.value
        // if (placa == '#') {
        //     div_erro.style.display = 'block'
        //     span_mensagem_erro.innerHTML = "SELECIONE UM VEÍCULO PARA ACESSAR A DASHBOARD!"
        //     setTimeout(function () {
        //         div_erro.style.display = 'none'
        //     }, 2000);
        // } else if (placa == 'placaUM') {
        //     veiculos.style = 'display: none'
        //     dashHPG7G77.style = 'display: none'
        //     dashFCB1B34.style = 'display: block;'
        //     opcoes_menu.style = 'display: block;'

        /* DADOS DASHBOARD VEÍCULO UM */
        /* -- lm35Temperatura */
        var contextoLm35Temperatura = document.getElementById('lm35TemperaturaUM').getContext('2d');
        contextoLm35Temperatura.canvas.width = 700;
        contextoLm35Temperatura.canvas.height = 500;
        var lm35Temperatura = new Chart(
            contextoLm35Temperatura,
            {
                type: 'line',
                data: {
                    labels: [1, 2, 3, 4, 5, 6],
                    datasets: [{
                        label: 'Sensor 1',
                        borderColor: '#FFF348',
                        backgroundColor: '#FFF348',
                        fill: false,
                        data: [30, 32, 31, 30, 31.5, 29.5]
                    },
                    {
                        label: 'Sensor 2',
                        borderColor: '#123456',
                        backgroundColor: '#123456',
                        fill: false,
                        data: [20, 28, 26, 27, 26.5, 27.5]
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,

                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );
        /* -- chave */
        const bancos = sessionStorage.QTDBANCOS_VAN

        const container = document.getElementById('graficos_bancos');

        const chave = {};


        for (let i = 1; i <= bancos; i++) {
            let div = document.createElement('div');
            div.className = 'div-graficos'
            let canvas = document.createElement('canvas');
            canvas.id = `chart${i}`;
            canvas.className = 'chart-container';
            canvas.style = "width= 100px; !important";
            canvas.style = "height = 80px; !important";
            container.appendChild(div);
            div.appendChild(canvas);

            let ctx = canvas.getContext('2d');

            // contextoChave.canvas.width = 650;
            // contextoChave.canvas.height = 400;
            chave[`chart${i}`] = new Chart(
                ctx,
                {
                    type: 'bar',
                    data: {
                        labels: [`'${i}'`],
                        datasets: [{
                            label: `Banco ${i}`,
                            data: [1],
                            type: 'bar',
                            borderColor: '#FFB800',
                            backgroundColor: '#FFB800'
                        }]
                    },
                    options: {

                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                display: false,
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                distribution: 'series',
                                display: true,
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        },
                        plugins: {
                            legend: {
                                display: true,
                                label: {
                                    color: '#000000'
                                }
                            },
                        }
                    }
                }
            );

        }

        // } else if (placa == 'placaDOIS') {
        //     veiculos.style = 'display: none'
        //     dashHPG7G77.style = 'display: block'
        //     dashFCB1B34.style = 'display: none'
        //     opcoes_menu.style = 'display: block;'
        // }
        /* DADOS DASHBOARD VEICULO DOIS */
        /* -- lm35Temperatura */
        //         var contextoLm35Temperatura = document.getElementById('lm35TemperaturaDOIS').getContext('2d');
        //         contextoLm35Temperatura.canvas.width = 650;
        //         contextoLm35Temperatura.canvas.height = 400;
        //         var lm35Temperatura = new Chart(
        //             contextoLm35Temperatura,
        //             {
        //                 type: 'line',
        //                 data: {
        //                     labels: [1, 2, 3, 4, 5, 6],
        //                     datasets: [{
        //                         label: 'Sensor 1',
        //                         borderColor: '#FFF348',
        //                         backgroundColor: '#FFF348',
        //                         fill: false,
        //                         data: [20, 21, 22, 24, 23.5, 22.5]
        //                     },
        //                     {
        //                         label: 'Sensor 2',
        //                         borderColor: '#123456',
        //                         backgroundColor: '#123456',
        //                         fill: false,
        //                         data: [22, 24, 25, 24, 26.5, 27.5]
        //                     }]
        //                 },
        //                 options: {
        //                     scales: {
        //                         xAxes: [{
        //                             distribution: 'series',
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }],
        //                         yAxes: [{
        //                             scaleLabel: {
        //                                 display: true,

        //                             },
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }]
        //                     },
        //                     animation: {
        //                         duration: 0
        //                     }
        //                 }
        //             }
        //         );
        //         /* -- chave */
        //         var contextoChave = document.getElementById('chaveDOIS').getContext('2d');
        //         contextoChave.canvas.width = 650;
        //         contextoChave.canvas.height = 400;
        //         var chave = new Chart(
        //             contextoChave,
        //             {
        //                 type: 'bar',
        //                 data: {
        //                     labels: ['1', '2', '3', '4', '5', '6'],
        //                     datasets: [{
        //                         label: 'Ocupado',
        //                         data: [1, 1, 1, 1, 1, 1, 1],
        //                         type: 'bar',
        //                         borderColor: '#FFB800',
        //                         backgroundColor: '#FFB800'
        //                     }]
        //                 },
        //                 options: {
        //                     scales: {
        //                         xAxes: [{
        //                             distribution: 'series',
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }],
        //                         yAxes: [{
        //                             scaleLabel: {
        //                                 display: true,
        //                             },
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }]
        //                     },
        //                     animation: {
        //                         duration: 0
        //                     }
        //                 }
        //             }
        //         );

        //         var contextoChave = document.getElementById('chave2DOIS').getContext('2d');
        //         contextoChave.canvas.width = 650;
        //         contextoChave.canvas.height = 400;
        //         var chave = new Chart(
        //             contextoChave,
        //             {
        //                 type: 'bar',
        //                 data: {
        //                     labels: ['7', '8', '9', '10', '11', '12'],
        //                     datasets: [{
        //                         label: 'Ocupado',
        //                         data: [0, 0, 0, 0, 1, 0],
        //                         type: 'bar',
        //                         borderColor: '#FFB800',
        //                         backgroundColor: '#FFB800'
        //                     }]
        //                 },
        //                 options: {
        //                     scales: {
        //                         xAxes: [{
        //                             distribution: 'series',
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }],
        //                         yAxes: [{
        //                             scaleLabel: {
        //                                 display: true,
        //                             },
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }]
        //                     },
        //                     animation: {
        //                         duration: 0
        //                     }
        //                 }
        //             }
        //         );
        //         var contextoChave = document.getElementById('chave3DOIS').getContext('2d');
        //         contextoChave.canvas.width = 650;
        //         contextoChave.canvas.height = 400;
        //         var chave = new Chart(
        //             contextoChave,
        //             {
        //                 type: 'bar',
        //                 data: {
        //                     labels: ['13', '14', '15', '16', '17', '18'],
        //                     datasets: [{
        //                         label: 'Ocupado',
        //                         data: [1, 1, 1, 0, 1, 0],
        //                         type: 'bar',
        //                         borderColor: '#FFB800',
        //                         backgroundColor: '#FFB800'
        //                     }]
        //                 },
        //                 options: {
        //                     scales: {
        //                         xAxes: [{
        //                             distribution: 'series',
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }],
        //                         yAxes: [{
        //                             scaleLabel: {
        //                                 display: true,
        //                             },
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }]
        //                     },
        //                     animation: {
        //                         duration: 0
        //                     }
        //                 }
        //             }
        //         );
        //         var contextoChave = document.getElementById('chave4DOIS').getContext('2d');
        //         contextoChave.canvas.width = 650;
        //         contextoChave.canvas.height = 400;
        //         var chave = new Chart(
        //             contextoChave,
        //             {
        //                 type: 'bar',
        //                 data: {
        //                     labels: ['19', '20', '21', '22', '23', '24'],
        //                     datasets: [{
        //                         label: 'Ocupado',
        //                         data: [1, 0, 0, 0, 1, 1],
        //                         type: 'bar',
        //                         borderColor: '#FFB800',
        //                         backgroundColor: '#FFB800'
        //                     }]
        //                 },
        //                 options: {
        //                     scales: {
        //                         xAxes: [{
        //                             distribution: 'series',
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }],
        //                         yAxes: [{
        //                             scaleLabel: {
        //                                 display: true,
        //                             },
        //                             ticks: {
        //                                 beginAtZero: true
        //                             }
        //                         }]
        //                     },
        //                     animation: {
        //                         duration: 0
        //                     }
        //                 }
        //             }
        //         );

        //     }
    }




</script>